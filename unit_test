 æ‰§è¡Œpython unit/123.py å‡ºç°è¿™ä¸ªé”™è¯¯å†…å®¹[Errno 2] No such file or directory
ChatGPT:

ä½ é‡åˆ°çš„é”™è¯¯ï¼š

[Errno 2] No such file or directory


è¯´æ˜ Python æ²¡æœ‰æ‰¾åˆ°ä½ è¦æ‰§è¡Œçš„è„šæœ¬ unit/123.pyã€‚å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç§åŸå› ï¼š

è·¯å¾„å†™é”™äº†

ä½ å½“å‰æ‰€åœ¨ç›®å½•ä¸‹ï¼Œå¯èƒ½å¹¶æ²¡æœ‰ unit/123.py è¿™ä¸ªæ–‡ä»¶ã€‚

å¯ä»¥å…ˆæ‰§è¡Œï¼š

ls unit


çœ‹çœ‹ç›®å½•ä¸‹æ˜¯ä¸æ˜¯æœ‰ 123.pyã€‚

æ‰§è¡Œç›®å½•ä¸å¯¹

å¦‚æœä½ åœ¨åˆ«çš„ç›®å½•æ‰§è¡Œ python unit/123.pyï¼Œè€Œå½“å‰ç›®å½•ä¸‹å¹¶æ²¡æœ‰ unit è¿™ä¸ªå­ç›®å½•ï¼Œå°±ä¼šæŠ¥é”™ã€‚

å»ºè®®å…ˆ cd åˆ°æ­£ç¡®çš„é¡¹ç›®æ ¹ç›®å½•ï¼Œå†è¿è¡Œã€‚

æ–‡ä»¶åæœ‰è¯¯

å¯èƒ½æ–‡ä»¶åä¸æ˜¯ 123.pyï¼Œè€Œæ˜¯ 123.PYã€123 (1).py ä¹‹ç±»çš„ã€‚Linux/Unix ç³»ç»Ÿæ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚

ä½ å¯ä»¥è¯•ä¸€ä¸‹ï¼š

find . -name "123.py"


æ¥ç¡®è®¤æ–‡ä»¶ä½ç½®ã€‚

ç¯å¢ƒé—®é¢˜

å¦‚æœä½ åœ¨è™šæ‹Ÿç¯å¢ƒé‡Œï¼Œç¡®è®¤æ˜¯ä¸æ˜¯æ–‡ä»¶è·¯å¾„è¢«éš”ç¦»äº†ã€‚

ğŸ‘‰ å»ºè®®æ’æŸ¥æ­¥éª¤ï¼š

pwd                  # ç¡®è®¤å½“å‰è·¯å¾„
ls -R | grep 123.py  # æŸ¥æ‰¾ 123.py æ–‡ä»¶


æ‰¾åˆ°æ­£ç¡®çš„ç›®å½•åï¼Œå†æ‰§è¡Œï¼š

python unit/123.py


è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ªå¿«é€Ÿçš„ æ£€æŸ¥è„šæœ¬æ˜¯å¦å­˜åœ¨å¹¶æ‰§è¡Œ çš„å‘½ä»¤ï¼Ÿè¿™æ ·å°±èƒ½è‡ªåŠ¨æç¤ºæ–‡ä»¶è·¯å¾„å¯¹ä¸å¯¹ã€‚

ã‚ãªãŸ:
No module named 'test_my_cdk_project'ä»€ä¹ˆæ„æ€
ChatGPT:

è¿™ä¸ªé”™è¯¯ï¼š

No module named 'test_my_cdk_project'


æ„æ€æ˜¯ï¼šPython åœ¨å½“å‰ç¯å¢ƒé‡Œæ‰¾ä¸åˆ°å« test_my_cdk_project çš„æ¨¡å—æˆ–åŒ…ã€‚

å‡ºç°è¿™ä¸ªé—®é¢˜çš„å¸¸è§åŸå› æœ‰ï¼š

ğŸ” å¸¸è§åŸå› 

åŒ…/æ¨¡å—æ²¡åœ¨å½“å‰ç›®å½•

ä½ è¿è¡Œçš„è„šæœ¬é‡Œæœ‰ï¼š

import test_my_cdk_project


ä½†æ˜¯å½“å‰ç›®å½•ä¸‹æ²¡æœ‰ test_my_cdk_project æ–‡ä»¶å¤¹ï¼ˆé‡Œé¢éœ€è¦æœ‰ __init__.pyï¼‰ï¼Œä¹Ÿæ²¡æœ‰ test_my_cdk_project.py æ–‡ä»¶ã€‚

æ²¡åŠ åˆ° PYTHONPATH

å¦‚æœ test_my_cdk_project åœ¨é¡¹ç›®çš„å­ç›®å½•é‡Œï¼ŒPython é»˜è®¤ä¸ä¼šå»æ‰¾ï¼Œéœ€è¦æŠŠè·¯å¾„åŠ åˆ°ç¯å¢ƒå˜é‡ PYTHONPATHï¼Œæˆ–è€…åœ¨ä»£ç é‡Œæ‰‹åŠ¨ä¿®æ”¹ sys.pathã€‚

å®‰è£…æ–¹å¼ä¸å¯¹

å¦‚æœè¿™æ˜¯ä¸€ä¸ªé¡¹ç›®åŒ…ï¼Œå¯èƒ½éœ€è¦å…ˆæ‰§è¡Œï¼š

pip install -e .


ï¼ˆåœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œä¸”æœ‰ setup.py æˆ– pyproject.tomlï¼‰

æ‰§è¡Œè·¯å¾„ä¸å¯¹

ä¾‹å¦‚åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åº”è¯¥æ‰§è¡Œï¼š

python -m unittest test_my_cdk_project/test_xxx.py


è€Œä¸æ˜¯ç›´æ¥ python test_xxx.pyï¼Œå¦åˆ™å¯¼å…¥è·¯å¾„ä¼šä¸å¯¹ã€‚

âœ… è§£å†³æ–¹æ³•å»ºè®®

ç¡®è®¤ç›®å½•ç»“æ„ï¼Œæ¯”å¦‚ï¼š

my-cdk-project/
â”œâ”€â”€ test_my_cdk_project/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_stack.py
â”œâ”€â”€ app.py
â””â”€â”€ cdk.json


è¿è¡Œæ—¶åˆ‡åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼š

cd my-cdk-project
python -m unittest discover -s test_my_cdk_project


å¦‚æœ test_my_cdk_project æ˜¯æºç åŒ…ï¼Œå¯ä»¥åœ¨æ ¹ç›®å½•å…ˆæ‰§è¡Œï¼š

pip install -e .


è¦ä¸è¦ä½ æŠŠä½ çš„ é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆæ ‘çŠ¶ï¼‰ ç»™æˆ‘çœ‹ä¸€ä¸‹ï¼Ÿè¿™æ ·æˆ‘èƒ½å‘Šè¯‰ä½ æ˜¯è·¯å¾„é—®é¢˜è¿˜æ˜¯éœ€è¦åŠ  __init__.pyã€‚

ã‚ãªãŸ:
PYTHONPATHæ˜¯ä»€ä¹ˆ
ChatGPT:

å¥½é—®é¢˜ ğŸ‘

PYTHONPATH æ˜¯ä¸€ä¸ª ç¯å¢ƒå˜é‡ï¼Œç”¨æ¥å‘Šè¯‰ Python åœ¨å“ªäº›ç›®å½•é‡ŒæŸ¥æ‰¾æ¨¡å—å’ŒåŒ…ã€‚

ğŸ“Œ Python æŸ¥æ‰¾æ¨¡å—çš„é¡ºåº

å½“ä½ åœ¨ä»£ç é‡Œå†™ï¼š

import my_module


Python ä¼šæŒ‰ç…§é¡ºåºå»è¿™äº›åœ°æ–¹æ‰¾ï¼š

å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨çš„ç›®å½•

æ ‡å‡†åº“ç›®å½•ï¼ˆéš Python è‡ªå¸¦çš„æ¨¡å—ï¼Œæ¯”å¦‚ osã€sysï¼‰

site-packagesï¼ˆä½ ç”¨ pip install å®‰è£…çš„åº“éƒ½åœ¨è¿™é‡Œï¼‰

ç¯å¢ƒå˜é‡ PYTHONPATH é‡Œå®šä¹‰çš„ç›®å½•

å¦‚æœè¿™äº›åœ°æ–¹éƒ½æ‰¾ä¸åˆ°ï¼Œå°±ä¼šæŠ¥é”™ï¼š

ModuleNotFoundError: No module named 'my_module'

ğŸ“Œ ä¸¾ä¸ªä¾‹å­

å‡è®¾ä½ çš„ç›®å½•ç»“æ„æ˜¯ï¼š

project/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ my_module.py
â””â”€â”€ tests/
    â””â”€â”€ test_app.py


åœ¨ test_app.py é‡Œå†™ï¼š

import my_module


ç›´æ¥è¿è¡Œä¼šæŠ¥é”™ï¼Œå› ä¸º my_module.py åœ¨ src/ é‡Œï¼Œé»˜è®¤ä¸ä¼šè¢«æ‰¾åˆ°ã€‚

è§£å†³åŠæ³• 1ï¼šè®¾ç½® PYTHONPATH

è¿è¡Œæ—¶åŠ ä¸Š PYTHONPATHï¼š

PYTHONPATH=./src python tests/test_app.py


è¿™æ · Python å°±ä¼šå» ./src ç›®å½•é‡Œæ‰¾æ¨¡å—ã€‚

è§£å†³åŠæ³• 2ï¼šæ°¸ä¹…æ·»åŠ 

åœ¨ Linux/macOSï¼š

export PYTHONPATH=$PYTHONPATH:/path/to/project/src


åœ¨ Windows PowerShellï¼š

$env:PYTHONPATH = "$env:PYTHONPATH;C:\path\to\project\src"

è§£å†³åŠæ³• 3ï¼šä»£ç é‡Œæ”¹ sys.path
import sys
sys.path.append("src")

import my_module


ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼Œä¸æ¨èé•¿æœŸä½¿ç”¨ï¼‰

ğŸ‘‰ æ€»ç»“ä¸€ä¸‹ï¼š

PYTHONPATH å°±æ˜¯ Python æ‰¾æ¨¡å—çš„é¢å¤–è·¯å¾„æ¸…å•ã€‚

ä½ å¯ä»¥é€šè¿‡è®¾ç½®å®ƒï¼Œè®© Python è¯†åˆ«ä½ é¡¹ç›®çš„æºç ç›®å½•ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ å†™ä¸€ä¸ª æ£€æŸ¥ PYTHONPATH å¹¶æ‰“å°å½“å‰æœç´¢è·¯å¾„ çš„å° Python è„šæœ¬ï¼Ÿè¿™æ ·ä½ èƒ½ç«‹åˆ»çœ‹åˆ° Python åœ¨å“ªäº›ç›®å½•é‡Œæ‰¾æ¨¡å—ã€‚

ã‚ãªãŸ:
import aws_cdk as core
import aws_cdk.assertions as assertions

from test_my_cdk_project.test_my_cdk_project_stack import TestMyCdkProjectStack

# example tests. To run these tests, uncomment this file along with the example
# resource in test_my_cdk_project/test_my_cdk_project_stack.py
def test_sqs_queue_created():
    app = core.App()
    stack = TestMyCdkProjectStack(app, "test-my-cdk-project")
    template = assertions.Template.from_stack(stack)

#     template.has_resource_properties("AWS::SQS::Queue", {
#         "VisibilityTimeout": 300
#     })  è¦å¦‚ä½•åœ¨vscodeè·‘é€š
ChatGPT:

æ˜ç™½ âœ… ä½ è¿™æ˜¯ AWS CDK é¡¹ç›®çš„å•å…ƒæµ‹è¯•ï¼ˆç”¨ pytest æˆ– unittest è·‘ï¼‰ã€‚
ç°åœ¨çš„é”™è¯¯ No module named 'test_my_cdk_project' è¯´æ˜ Python æ²¡æ‰¾åˆ°ä½ é¡¹ç›®é‡Œçš„åŒ…ã€‚

ğŸ” ä½ ä»£ç é‡Œçš„æƒ…å†µ
from test_my_cdk_project.test_my_cdk_project_stack import TestMyCdkProjectStack


ğŸ‘‰ è¿™è¦æ±‚ç›®å½•ç»“æ„åƒè¿™æ ·ï¼ˆæ ‡å‡† CDK Python é¡¹ç›®ç»“æ„ï¼‰ï¼š

test-my-cdk-project/
â”œâ”€â”€ app.py
â”œâ”€â”€ cdk.json
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ test_my_cdk_project/        â† åŒ…åï¼ˆå¿…é¡»æœ‰ __init__.pyï¼‰
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_my_cdk_project_stack.py
â””â”€â”€ tests/                      â† æµ‹è¯•ç›®å½•
    â””â”€â”€ test_test_my_cdk_project.py

âš¡ åœ¨ VSCode é‡Œè·‘é€šæ­¥éª¤

ç¡®è®¤ç›®å½•ç»“æ„æ­£ç¡®

test_my_cdk_project/ ç›®å½•é‡Œè¦æœ‰ __init__.pyï¼ˆå“ªæ€•æ˜¯ç©ºæ–‡ä»¶ï¼‰ï¼Œè¿™æ ·å®ƒæ‰æ˜¯ä¸€ä¸ªåˆæ³•çš„ Python åŒ…ã€‚

test_my_cdk_project_stack.py é‡Œåº”è¯¥å®šä¹‰äº†ï¼š

class TestMyCdkProjectStack(core.Stack):
    ...


å®‰è£…ä¾èµ–
åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

pip install -r requirements.txt
pip install pytest


ï¼ˆrequirements.txt é‡Œä¼šæœ‰ aws-cdk-libï¼Œå¦‚æœæ²¡æœ‰ä½ è¦è‡ªå·±åŠ ä¸Šï¼‰

è®¾ç½® VSCode Python è·¯å¾„

åœ¨ VSCode é‡ŒæŒ‰ Ctrl+Shift+P â†’ é€‰ Python: Select Interpreter â†’ é€‰ä½ å®‰è£…ä¾èµ–çš„è™šæ‹Ÿç¯å¢ƒã€‚

è¿™æ · VSCode çš„æµ‹è¯•è¿è¡Œå™¨æ‰èƒ½æ‰¾åˆ° aws_cdkã€‚

è¿è¡Œæµ‹è¯•
åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆå’Œ cdk.json åŒä¸€çº§ï¼‰æ‰§è¡Œï¼š

pytest tests/


æˆ–è€…åœ¨ VSCode é‡Œç‚¹ Run Testã€‚

ğŸ› ï¸ å¸¸è§å‘

å¦‚æœä½ ç›´æ¥ cd tests && python test_xxx.py ä¼šæŠ¥ No module named 'test_my_cdk_project'ï¼Œå› ä¸ºå°‘äº†æ ¹ç›®å½•ã€‚
æ­£ç¡®æ–¹å¼æ˜¯ï¼š

cd test-my-cdk-project   # é¡¹ç›®æ ¹ç›®å½•
pytest


å¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œå¯ä»¥åœ¨ tests/test_test_my_cdk_project.py é‡ŒåŠ ï¼š

import sys, os
sys.path.append(os.path.dirname(os.path.dirname(__file__)))


è¿™æ ·å¼ºåˆ¶æŠŠé¡¹ç›®æ ¹ç›®å½•åŠ åˆ° Python æœç´¢è·¯å¾„ã€‚

ğŸ‘‰ ä½ è¦ä¸è¦æŠŠä½ çš„ **é¡¹ç›®ç›®å½•æ ‘ï¼ˆæ¯”å¦‚ tree -L 2 çš„è¾“å‡ºï¼‰**å‘æˆ‘ï¼Ÿ
è¿™æ ·æˆ‘èƒ½ç›´æ¥å‘Šè¯‰ä½  PYTHONPATH è¦æ€ä¹ˆè®¾ç½®ï¼Œæ‰èƒ½åœ¨ VSCode ä¸€é”®è·‘é€šæµ‹è¯•ã€‚

ã‚ãªãŸ:
pip install -r requirements.txtè¿è¡Œåå‡ºç°ä¸‹é¢é”™è¯¯ERROR: Could not find a version that satisfies the requirement aws-cdk-local (from versions: none) 
ERROR: No matching distribution found for aws-cdk-local
ChatGPT:

å¯¹ï¼Œè¿™ä¸ªæŠ¥é”™æ˜¯å› ä¸º aws-cdk-local ä¸æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡ pip å®‰è£…çš„åŒ…ã€‚
å®ƒå…¶å®æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œåå­—å« cdk-localï¼Œä¸»è¦ç”¨æ¥é…åˆ LocalStack
 åœ¨æœ¬åœ°æµ‹è¯• CDKã€‚

ğŸ“Œ ä¸ºä»€ä¹ˆä¼šå‡ºé”™ï¼Ÿ

requirements.txt é‡Œå¯èƒ½æœ‰ä¸€è¡Œï¼š

aws-cdk-local


ä½† PyPI ä¸Šæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªåº“ï¼Œæ‰€ä»¥ pip æ‰¾ä¸åˆ°ã€‚

âœ… è§£å†³æ–¹æ³•

å¦‚æœä½ ä¸æ‰“ç®—åœ¨ LocalStack ä¸Šè·‘ CDK
ğŸ‘‰ ç›´æ¥åˆ æ‰ requirements.txt é‡Œçš„ aws-cdk-local è¿™ä¸€è¡Œï¼Œå†è¿è¡Œï¼š

pip install -r requirements.txt


å¦‚æœä½ çœŸçš„è¦åœ¨ LocalStack ä¸Šè·‘ CDK
ğŸ‘‰ éœ€è¦ç”¨ npm å®‰è£…ï¼ˆè€Œä¸æ˜¯ pipï¼‰ï¼š

npm install -g cdk-local


ç„¶åè¿è¡Œ CDK æ—¶ç”¨ï¼š

cdklocal deploy


å®ƒå…¶å®æ˜¯ cdk çš„ wrapperï¼Œè‡ªåŠ¨æŠŠ AWS API endpoint æŒ‡å‘ LocalStackã€‚

ç¡®è®¤å¿…éœ€ä¾èµ–
åœ¨ requirements.txt é‡Œï¼Œå’Œ CDK ç›¸å…³çš„æ ¸å¿ƒ Python ä¾èµ–åº”è¯¥æ˜¯ï¼š

aws-cdk-lib>=2.0.0
constructs>=10.0.0,<11.0.0


ï¼ˆaws-cdk-local ä¸å±äº Python ä¾èµ–ï¼‰

âš¡ æ€»ç»“ï¼š

aws-cdk-local ä¸å­˜åœ¨äº PyPI â†’ ç”¨ npm å®‰è£… cdk-localã€‚

å¦‚æœä¸æ‰“ç®—ç”¨ LocalStack â†’ åˆ é™¤å®ƒï¼Œä¸å½±å“æ­£å¸¸è·‘ CDK æµ‹è¯•ã€‚

è¦ä¸è¦æˆ‘å¸®ä½ æ”¹ä¸€ä¸ª æ­£ç¡®çš„ requirements.txt æ¨¡æ¿ï¼Ÿè¿™æ ·ä½ ç›´æ¥æ›¿æ¢å°±èƒ½ pip install è·‘é€šã€‚

ã‚ãªãŸ:
éœ€è¦
ChatGPT:

å¥½çš„ ğŸ‘ æˆ‘å¸®ä½ æ•´ç†ä¸€ä¸ª æ ‡å‡† AWS CDK (Python) é¡¹ç›® requirements.txt æ¨¡æ¿ï¼Œå»æ‰äº†é”™è¯¯çš„ aws-cdk-localï¼Œè¿™æ ·ä½ å¯ä»¥ç›´æ¥ pip install -r requirements.txt è·‘é€šã€‚

âœ… æ¨èçš„ requirements.txt
# AWS CDK åŸºç¡€åº“
aws-cdk-lib>=2.0.0,<3.0.0

# CDK ä¾èµ– constructsï¼ˆå®šä¹‰ CDK construct çš„æŠ½è±¡ç±»ï¼‰
constructs>=10.0.0,<11.0.0

# æµ‹è¯•æ¡†æ¶ï¼ˆå¯é€‰ï¼‰
pytest>=7.0.0

ğŸ“Œ å¦‚æœä½ è¦é…åˆ LocalStack ä½¿ç”¨

é‚£å°± ä¸è¦å†™åœ¨ requirements.txt é‡Œï¼Œè€Œæ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•å®‰è£… npm åŒ…ï¼š

npm install -g cdk-local


ä¹‹åè¿è¡Œ CDK æ—¶ç”¨ï¼š

cdklocal deploy

âš¡ ä½¿ç”¨æ–¹æ³•
# ç¡®è®¤åœ¨è™šæ‹Ÿç¯å¢ƒé‡Œ
python -m venv .venv
source .venv/bin/activate   # Linux/Mac
.venv\Scripts\activate      # Windows PowerShell

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# éªŒè¯
pip list | grep aws-cdk-lib


è¦ä¸è¦æˆ‘å¸®ä½ æŠŠ å®Œæ•´çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼ˆCDK init python-app åˆ›å»ºçš„ï¼‰+ è¿™ä¸ª requirements.txt ä¸€èµ·åˆ—å‡ºæ¥ï¼Ÿè¿™æ ·ä½ å¯ä»¥å¯¹ç…§ä½ çš„é¡¹ç›®ï¼Œçœ‹æ˜¯ä¸æ˜¯å“ªé‡Œç¼ºäº†æ–‡ä»¶ã€‚

ã‚ãªãŸ:
pytest tests/ã€€è·‘å®Œåä¼šæœ‰ä»€ä¹ˆæ ·çš„ç»“æœ
ChatGPT:

å¾ˆå¥½çš„é—®é¢˜ ğŸ‘

å½“ä½ è¿è¡Œï¼š

pytest tests/


å®ƒä¼šå»æ‰§è¡Œ tests/ ç›®å½•ä¸‹çš„æ‰€æœ‰ æµ‹è¯•å‡½æ•°ï¼ˆä»¥ test_ å¼€å¤´çš„æ–‡ä»¶ã€å‡½æ•°ã€ç±»æ–¹æ³•ï¼‰ã€‚

ğŸ“Œ å¸¸è§è¾“å‡ºç»“æœ
âœ… å…¨éƒ¨é€šè¿‡
============================= test session starts =============================
platform darwin -- Python 3.11.4, pytest-7.4.0, pluggy-1.2.0
rootdir: /Users/you/my-cdk-project
collected 1 item

tests/test_test_my_cdk_project.py .                                     [100%]

============================== 1 passed in 0.50s ==============================


collected 1 item â†’ æ‰¾åˆ° 1 ä¸ªæµ‹è¯•

. â†’ æµ‹è¯•é€šè¿‡

1 passed â†’ æ‰€æœ‰æµ‹è¯•æˆåŠŸ
