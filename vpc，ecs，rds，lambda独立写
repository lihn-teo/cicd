æ˜ç™½äº†ï¼Œä½ ç°åœ¨çš„ç›®æ ‡æ˜¯åœ¨ LocalStack ä¸Šç”¨ Python + CDK/SDK æ¥æ„å»ºä¸€ä¸ªåŸºç¡€ AWS ç¯å¢ƒï¼ˆVPCã€ECSã€Auroraï¼‰ï¼Œä¹‹åå†è¿½åŠ  Lambdaï¼Œå¹¶åœ¨ VSCode ä¸Šæ‰§è¡Œï¼ŒåŒæ—¶ä½ å·²ç»ç”¨ Docker å»ºç«‹äº†ä¸€ä¸ªé¡¹ç›®æ¡†æ¶ã€‚æˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹æ­¥éª¤æ¥è§„åˆ’å’Œå®ç°ï¼š

1ï¸âƒ£ å‡†å¤‡å·¥ä½œ
ç¯å¢ƒç¡®è®¤

LocalStack å·²é€šè¿‡ Docker å¯åŠ¨

docker run --rm -it -p 4566:4566 -p 4571:4571 localstack/localstack


Python ç¯å¢ƒ

å»ºè®® Python 3.11+

åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼š

python -m venv .venv
source .venv/bin/activate  # Linux/macOS
.venv\Scripts\activate     # Windows


å®‰è£… AWS CDK/SDK

pip install aws-cdk-lib constructs boto3 localstack-client


å¦‚æœæƒ³ç”¨ CDK æœ¬åœ°åŒ–ï¼š

pip install aws-cdk-local


âš ï¸ æ³¨æ„ï¼šaws-cdk-local æœ‰äº›ç‰ˆæœ¬å¯èƒ½åœ¨ pip ä¸Šæ‰¾ä¸åˆ°ï¼Œå¯ä»¥ç”¨ npm å®‰è£… Node ç‰ˆæœ¬ï¼š

npm install -g aws-cdk-local

é…ç½® VSCode

å®‰è£… Python æ’ä»¶å’Œ Docker æ’ä»¶

é…ç½® VSCode terminal æŒ‡å‘è™šæ‹Ÿç¯å¢ƒ

å¯ä»¥æŠŠ LocalStack Endpoint é…ç½®ä¸ºç¯å¢ƒå˜é‡ï¼š

export AWS_ACCESS_KEY_ID=test
export AWS_SECRET_ACCESS_KEY=test
export AWS_DEFAULT_REGION=us-east-1
export LOCALSTACK_HOST=localhost
export EDGE_PORT=4566

2ï¸âƒ£ é¡¹ç›®ç»“æ„å»ºè®®
my_localstack_project/
â”‚
â”œâ”€â”€ app.py               # CDK/SDKå…¥å£æ–‡ä»¶
â”œâ”€â”€ cdk.json             # CDKé¡¹ç›®é…ç½®
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ stacks/
â”‚   â”œâ”€â”€ vpc_stack.py
â”‚   â”œâ”€â”€ ecs_stack.py
â”‚   â”œâ”€â”€ aurora_stack.py
â”‚   â””â”€â”€ lambda_stack.py
â”œâ”€â”€ lambda_functions/
â”‚   â””â”€â”€ my_lambda.py
â””â”€â”€ README.md


æ¯ä¸ª stack å¯ä»¥ç‹¬ç«‹ç»´æŠ¤ï¼Œæ–¹ä¾¿åæœŸè¿½åŠ  Lambdaã€‚

3ï¸âƒ£ ç¼–å†™ CDK Stack ç¤ºä¾‹ï¼ˆPythonï¼‰
VPC Stack
from aws_cdk import (
    Stack,
    aws_ec2 as ec2
)
from constructs import Construct

class VpcStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs):
        super().__init__(scope, construct_id, **kwargs)

        self.vpc = ec2.Vpc(
            self, "MyVpc",
            max_azs=2,
            nat_gateways=0
        )

Aurora Stack
from aws_cdk import (
    Stack,
    aws_rds as rds,
    aws_ec2 as ec2
)
from constructs import Construct

class AuroraStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, vpc: ec2.Vpc, **kwargs):
        super().__init__(scope, construct_id, **kwargs)

        self.db = rds.DatabaseCluster(
            self, "MyAurora",
            engine=rds.DatabaseClusterEngine.AURORA_MYSQL,
            instance_props=rds.InstanceProps(
                vpc=vpc,
                instance_type=ec2.InstanceType.of(
                    ec2.InstanceClass.BURSTABLE2, ec2.InstanceSize.SMALL
                )
            )
        )

ECS Stack
from aws_cdk import (
    Stack,
    aws_ecs as ecs,
    aws_ec2 as ec2
)
from constructs import Construct

class EcsStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, vpc: ec2.Vpc, **kwargs):
        super().__init__(scope, construct_id, **kwargs)

        cluster = ecs.Cluster(
            self, "EcsCluster",
            vpc=vpc
        )

Lambda Stackï¼ˆåæœŸè¿½åŠ ï¼‰
from aws_cdk import (
    Stack,
    aws_lambda as _lambda
)
from constructs import Construct

class LambdaStack(Stack):
    def __init__(self, scope: Construct, construct_id: str, **kwargs):
        super().__init__(scope, construct_id, **kwargs)

        my_lambda = _lambda.Function(
            self, "MyLambda",
            runtime=_lambda.Runtime.PYTHON_3_11,
            handler="my_lambda.handler",
            code=_lambda.Code.from_asset("lambda_functions")
        )

4ï¸âƒ£ app.py å…¥å£
#!/usr/bin/env python3
import os
from aws_cdk import App
from stacks.vpc_stack import VpcStack
from stacks.ecs_stack import EcsStack
from stacks.aurora_stack import AuroraStack
from stacks.lambda_stack import LambdaStack

app = App()

vpc_stack = VpcStack(app, "VpcStack")
ecs_stack = EcsStack(app, "EcsStack", vpc=vpc_stack.vpc)
aurora_stack = AuroraStack(app, "AuroraStack", vpc=vpc_stack.vpc)
lambda_stack = LambdaStack(app, "LambdaStack")

app.synth()

5ï¸âƒ£ åœ¨ LocalStack ä¸Šéƒ¨ç½²

å¦‚æœç”¨ CDK Localï¼š

cdk bootstrap --profile default
cdk deploy --all --require-approval never


æˆ–è€…ç›´æ¥ç”¨ boto3 + localstack-client åœ¨ Python ä¸­æ“ä½œ LocalStack APIï¼š

import boto3
from localstack_client.session import Session

session = Session()
ecs_client = session.client('ecs', endpoint_url="http://localhost:4566")
vpcs = session.client('ec2').describe_vpcs()
print(vpcs)


ğŸ’¡ Tips:

æœ¬åœ° LocalStack å¯¹ ECS å’Œ RDS æ¨¡æ‹Ÿæœ‰é™ï¼Œä¸ä¸€å®šæ”¯æŒå®Œæ•´åŠŸèƒ½ï¼Œä½†å¯ä»¥çœ‹åˆ°èµ„æº API å·²åˆ›å»ºã€‚

Lambda éƒ¨ç½²åå¯ä»¥ç›´æ¥ç”¨ boto3 invoke æˆ– LocalStack Web UI æµ‹è¯•ã€‚

æ¨èå…ˆåœ¨ CDK ä¸Šè·‘æˆåŠŸï¼Œå†è€ƒè™‘ SDK è„šæœ¬åŒ–ã€‚
